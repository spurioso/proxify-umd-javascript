<html>
	<head>
        <title>Proxy Link Generator</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type ="text/javascript"
            src ="http://www.google.com/jsapi"></script> <!-- You can also use "jquery-1.7.js" as your src-->
                    
        <script type ="text/javascript">

            //<![CDATA[
            google.load("jquery", "1");          
            
            $(document).ready(init);     
                        
            function init() { // clears the form                                
                $("#txtInput").val("");
                $("#txtOutput").val("");
            } // end init           
                      
            function proxify() { // adds proxy prefix to submitted link and percent-encodes it
                var permalink = $("#txtInput").val();
		var proxyprefix = "http://proxy-um.researchport.umd.edu/login?url="; // change to your institution's proxy prefix
                var permalinkproxied = proxyprefix + permalink; // add the proxy prefix to the user input;
                var permaproxyencoded = encodeURIComponent(permalinkproxied); // URL-encode the whole link
                bitly(permaproxyencoded);                             
            } // end proxify    
                           
             function bitly(longURL) { // sends proxied and percent-encoded link to Bitly API                             
                var base = "http://api.bitly.com/v3/shorten?";
		var key = ""; // register for a Bitly API key and put it here
		var login = "spurioso";
		var url = base + "login=" + login + "&apiKey=" + key + "&longUrl=" + longURL + "&format=json";				 
                $.getJSON(url, checkData);                                              
             } //end bitly           
             
             function checkData(data) { //checks status of Bitly API request and when finished adds the shortened Bitly link to the output textbox
                $("#txtOutput").val("");
                var test = data.data.url;
                $("#txtOutput").val(test);                
             } // end checkData                         
             
               //]]>
        </script>
    </head>
    <body>        
        <p>Insert a permalink from a library database into the form below and click the submit button. A new URL will be generated that includes a prefix that routes the link through the university's proxy server. The whole link is then shortened using the <a href="http://bitly.com/">bitly.com</a> service. You can use the generated link to share links into databases with people off campus, and you can also use the link as a bookmark for your own future use. To do this the manual way, see the <a href="http://lib.guides.umd.edu/aecontent.php?pid=233784&sid=1934195">Link to a Journal</a>  tab</p>
         <form>
            <fieldset>
                <label>Insert permalink: </label>
                <input type = "text"
                       id ="txtInput" 
                       onclick = "select()"/>                      
                <input type = "button" 
                       value = "submit"
                       onclick = "proxify()" /> 
                <input type = "button"
                       value = "clear"
                       onclick = "init()" /> <br> 
                <label>Permalink with proxy prefix: </label>
                 <input type = "text"
                          id ="txtOutput"
                          onclick ="select()" 
                          readonly = "readonly">
            </fieldset>
        </form>        
    </body>
</html>
